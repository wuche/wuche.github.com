---
layout: post
title: "add new detector in findbugs"
description: "add new detector in findbugs"
tags: [findbugs]
published: true
---
findbugs is a good tool to analysis code.but the detector in findbugs is not enough,so sometimes we need to write the detector by ourselves.   
add new detector step as follow:  
**write a java class in package**
    
    public class WebxActionThreadSafeCheck extends OpcodeStackDetector{
    	BugReporter bugReporter;
    
    	
    	
    	public WebxActionThreadSafeCheck(BugReporter bugReporter) {
    		super();
    		this.bugReporter = bugReporter;
    	}
    
    
    
    	@Override
    	public void sawOpcode(int seen) {
    		if (seen == GETSTATIC) {
    			if (getClassConstantOperand().equals("java/lang/System")
    					&& (getNameConstantOperand().equals("out") || getNameConstantOperand()
    							.equals("error"))) {
    				BugInstance bug = new BugInstance(this, "ACNTS_ACTION_CLASS_NOT_THREAD_SAFE",
    						NORMAL_PRIORITY).addClassAndMethod(this).addSourceLine(
    						this, getPC());
    				bug.addInt(getPC());
    				bugReporter.reportBug(bug);
    			}
    		}
    
    	}
    
    }


**add detector and bugPattern in findbugs.xml file.**  


		  <Detector class="edu.umd.cs.findbugs.detect.NullPointExceptionCheck" speed="fast" 
					reports="ACNTS_ACTIONCLASS_NOT_THREAD_SAFE" hidden="false"/>
          <BugPattern abbrev="ACNTS" type="ACNTS_ACTIONCLASS_NOT_THREAD_SAFE" category="EXPERIMENTAL"/>  

    

**add Detector and BugPattern in messages.xml file**    

    
      <Detector class="edu.umd.cs.findbugs.detect.WebxActionThreadSafeCheck">
    	  <Details>
    	   	  <![CDATA[
    	   	  <p>线上环境不能有System.out</p>
    	   	  ]]>
    	  </Details>
      </Detector>  

     <BugPattern type="ACNTS_ACTION_CLASS_NOT_THREAD_SAFE">
   	<ShortDescription>>线上环境不用使用system.out</ShortDescription>
   	<LongDescription>线上环境不用使用system.out</LongDescription>
   	<Details>
 		<![CDATA[
   			<p>线上环境不用使用system.out</p>
 		]]>
   	</Details>
 </BugPattern> 

 
definite the "args = new String[]{"D:\\Users\\wuche\\workspace\\test\\bin\\test"};" in Findbugs2.java,then run the Findbugs2.java as java application. we will see the bug description in the console of eclipse   



 
